# ğŸ“Œ ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € & í•¨ìˆ˜ ì‹¤ìŠµ ëª¨ìŒì§‘

ì´ ë¬¸ì„œëŠ” codingon_store_db ê¸°ë°˜ ì‹¤ìŠµ ë¬¸ì œë“¤ì„ SQL ì½”ë“œì™€ í•¨ê»˜ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

---

## ğŸ“ ì‹¤ìŠµ1: ê³ ê° ì£¼ë¬¸ ì¡°íšŒ / ì£¼ë¬¸ ìˆ˜ / ë°°ì†¡ë¹„ ë³´ì •

```sql
-- ì‹¤ìŠµ1
-- ë¬¸ì œ2ë²ˆ : íŠ¹ì • ê³ ê°ì´ ì£¼ë¬¸í•œ ì „ì²´ ì£¼ë¬¸ ê±´ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í”„ë¡œì‹œì €ë¥¼ ì‘ì„±í•˜ì„¸ìš”
-- í”„ë¡œì‹œì € ì´ë¦„: count_orders_by_customer
-- íŒŒë¼ë¯¸í„°: ì…ë ¥ - customerId INT, ì¶œë ¥ - totalOrders INT
-- í”„ë¡œì‹œì ¸ ì¶œë ¥: í•´ë‹¹ ê³ ê°ì˜ ì£¼ë¬¸ ìˆ˜
-- ì‚¬ìš© í…Œì´ë¸”: orders
DROP PROCEDURE count_orders_by_customer;
DELIMITER //
CREATE PROCEDURE count_orders_by_customer(
	IN customerId INT,
	OUT totalOrders INT
)
BEGIN
	SELECT COUNT(*) INTO totalOrders FROM orders
    WHERE customer_id = customerId;
END //
DELIMITER ;

SET @order_count = 0;
CALL count_orders_by_customer(1, @order_count);
SELECT @order_count;


-- ë¬¸ì œ3ë²ˆ : íŠ¹ì • ê³ ê°ì˜ ê°€ì¥ ìµœê·¼ ì£¼ë¬¸ ê±´ì˜ ë°°ì†¡ë¹„ì— 3,000ì›ì„ ì¶”ê°€í•˜ì—¬ ë°˜í™˜í•˜ëŠ” í”„ë¡œì‹œì €ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
-- í”„ë¡œì‹œì € ì´ë¦„: add_bonus_to_latest_delivery_fee
-- íŒŒë¼ë¯¸í„°: ì…ë ¥ - customerId INT, ì…Â·ì¶œë ¥ - latestFee INT
-- í”„ë¡œì‹œì ¸ ì…/ì¶œë ¥: ê³ ê°ì˜ ìµœê·¼ ì£¼ë¬¸ì„ ê¸°ì¤€ìœ¼ë¡œ ë°°ì†¡ë¹„(delivery_fee)ì— 3,000ì›ì„ ì¶”ê°€í•˜ì—¬ ë°˜í™˜
-- ì‚¬ìš© í…Œì´ë¸”: orders
DROP PROCEDURE count_orders_by_customer;
DELIMITER //
CREATE PROCEDURE count_orders_by_customer(
	IN customerId INT,
	INOUT latestFee INT
)
BEGIN
	SELECT delivery_fee INTO latestFee
    FROM orders
    WHERE customer_id = customerId
    ORDER BY order_date DESC
    LIMIT 1;
    
    SET latestFee = IFNULL(latestFee, 0) + 3000;
END //
DELIMITER ;

SET @fee = 0;
CALL count_orders_by_customer(1, @fee);
SELECT @fee;
```

---

## ğŸ“ ì‹¤ìŠµ2: ê³ ê° ë“±ê¸‰ í• ì¸ / ë°˜ë³µ ì´ë¦„ ì¶œë ¥

```sql
-- ì‹¤ìŠµ2
-- ë¬¸ì œ1ë²ˆ : ê³ ê°ì˜ ë“±ê¸‰ì— ë”°ë¼ í• ì¸ìœ¨ì„ ë°˜í™˜í•˜ëŠ” ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
-- í”„ë¡œì‹œì € ì´ë¦„: get_discount_rate
-- íŒŒë¼ë¯¸í„°: 
-- IN level VARCHAR(20) : ê³ ê°ì˜ ë“±ê¸‰ì„ ì…ë ¥ë°›ìŒ
-- OUT discount DECIMAL(3,2) : í• ì¸ìœ¨ì„ ë°˜í™˜í•¨
-- ì¡°ê±´ ë¶„ê¸°:
-- ë“±ê¸‰ì´ 'VIP'ì´ë©´ í• ì¸ìœ¨ 20% (0.20)
-- ë“±ê¸‰ì´ 'Gold'ì´ë©´ í• ì¸ìœ¨ 10% (0.10)
-- ê·¸ ì™¸ ë“±ê¸‰ì€ í• ì¸ ì—†ìŒ (0.00)

DELIMITER //
CREATE PROCEDURE get_discount_rate(
	IN level VARCHAR(20),
    OUT discount DECIMAL(3,2)
)
BEGIN
	IF level = "VIP" THEN
		SET discount = 0.2;
	ELSEIF level = "Gold" THEN
		SET discount = 0.1;
	ELSE 
		SET discount = 0.0;
	END IF;
END //
DELIMITER ;

SET @discount_value = 0;
CALL get_discount_rate("Bronze", @discount_value);
SELECT @discount_value;

-- ë¬¸ì œ2. ì…ë ¥í•œ íšŸìˆ˜ë§Œí¼ ê³ ê° ì´ë¦„ì„ ìˆœì°¨ì ìœ¼ë¡œ ì¶œë ¥í•˜ëŠ” í”„ë¡œì‹œì €ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
-- í”„ë¡œì‹œì € ì´ë¦„: print_customer_names
-- íŒŒë¼ë¯¸í„°: 
-- IN repeat_count INT
-- ì¡°ê±´ ë¶„ê¸°:
-- 1ë²ˆ ê³ ê°ë¶€í„° ìˆœì„œëŒ€ë¡œ ì´ë¦„ì„ ì¶œë ¥í•˜ë©°
-- repeat_count ë§Œí¼ë§Œ ì¶œë ¥
-- ê³ ê° ìˆ˜ë³´ë‹¤ ë” í° ìˆ˜ê°€ ë“¤ì–´ì˜¤ë©´ ì¶œë ¥ ê°€ëŠ¥í•œ ë§Œí¼ë§Œ ì¶œë ¥í•˜ê³  ì¢…ë£Œ (LEASTí•¨ìˆ˜ í™œìš©)
-- LIMIT n, mì„ í™œìš©
USE codingon_store_db;

DELIMITER //
CREATE PROCEDURE print_customer_names(
	IN repeat_count INT
)
BEGIN
	DECLARE i INT DEFAULT 0;
    DECLARE total int;
    SELECT COUNT(*) INTO total FROM customers;
    SET repeat_count = LEAST(repeat_count, total);

	WHILE i < repeat_count DO
		SELECT name FROM customers
        ORDER BY customer_id
		LIMIT i, 1;
        
        SET i = i+1;
	END WHILE;
END //
DELIMITER ;

CALL print_customer_names(3);
```

---

## ğŸ“ ì‹¤ìŠµ3: ìƒë…„ì›”ì¼ â†’ ë‚˜ì´ ë°˜í™˜ í•¨ìˆ˜

```sql
-- ì‹¤ìŠµ3
-- ê³ ê°ì˜ ìƒë…„ì›”ì¼(DATE í˜•ì‹)ì„ ì…ë ¥ë°›ì•„, í˜„ì¬ ê¸°ì¤€ìœ¼ë¡œ ë§Œ ë‚˜ì´ë¥¼ ê³„ì‚°í•´ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
-- í”„ë¡œì‹œì € ì´ë¦„: calculate_age
-- íŒŒë¼ë¯¸í„°: birth_date DATE
-- ë°˜í™˜ê°’: INT (ë§Œ ë‚˜ì´)

DELIMITER //
CREATE FUNCTION calcurate_age(birth_date DATE)
RETURNS INT
DETERMINISTIC
BEGIN
	DECLARE age INT;
    
    SET age = YEAR(CURDATE()) - YEAR(birth_date);
    
    RETURN age;
END //
DELIMITER ;

SELECT name, calcurate_age(birth_date) í˜„ì¬ë‚˜ì´
FROM customers
WHERE birth_date IS NOT NULL;
```

---

